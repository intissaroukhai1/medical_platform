{% extends 'medecin/_layout_medecin.html.twig' %}

{% block medecin_content %}

<div class="header">
    <h1>Dashboard MÃ©decin</h1>

    <div class="user-profile">
        <div class="user-info">
            <div class="user-name">
                Dr. {{ app.user.prenom }} {{ app.user.nom }}
            </div>
            <div class="user-role">
                {{ app.user.specialite.nom ?? 'MÃ©decin' }}
            </div>
        </div>

        <div class="user-avatar">
            {% if app.user.photoProfil %}
                <img
                    src="{{ asset('uploads/photos/' ~ app.user.photoProfil) }}"
                    alt="Photo de profil"
                    style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;"
                >
            {% else %}
                {{ app.user.prenom|first|upper }}{{ app.user.nom|first|upper }}
            {% endif %}
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="dashboard-grid">
    <div class="card">
        <div class="card-header">
           <div class="card-title">RDV ce mois</div>
            <div class="card-icon">ğŸ“…</div>
        </div>
         <div class="card-value">
        {{ rdvMonthCount }}
    </div>
        <div class="card-description">Consultations prÃ©vues ce mois</div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">Patients</div>
            <div class="card-icon">ğŸ‘¥</div>
        </div>
        <div class="card-value">
    {{ patientsCount }}
</div>

        <div class="card-description">Sous suivi</div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">Ordonnances</div>
            <div class="card-icon">ğŸ’Š</div>
        </div>
         <div class="card-value">{{ ordonnancesMonthCount }}</div>
        <div class="card-description">Ce mois</div>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-title">Satisfaction</div>
            <div class="card-icon">â­</div>
        </div>
        <div class="card-value">4.8</div>
        <div class="card-description">/ 5 Ã©toiles</div>
    </div>
</div>

<!-- Calendar Section -->
<div class="calendar-section">
    <div class="calendar-header">
        <h2 class="section-title">ğŸ“… Calendrier - {{ date(calendarYear ~ '-' ~ calendarMonth ~ '-01')|date('F Y') }}</h2>
        <div class="calendar-nav">
            <button type="button" onclick="previousMonth()">â†</button>
<button type="button" onclick="nextMonth()">â†’</button>
        </div>
    </div>

    <div class="weekdays">
        <div class="weekday">Lun</div>
        <div class="weekday">Mar</div>
        <div class="weekday">Mer</div>
        <div class="weekday">Jeu</div>
        <div class="weekday">Ven</div>
        <div class="weekday">Sam</div>
        <div class="weekday">Dim</div>
    </div>
{% set currentMonth = date(calendarYear ~ '-' ~ calendarMonth ~ '-01') %}
    {% set firstDay = currentMonth|date_modify('first day of this month') %}
{% set daysInMonth = firstDay|date('t') %}
{% set startWeekDay = firstDay|date('N') %}

<div class="days">

    {# â¬…ï¸ Jours vides avant le 1er #}
    {% for i in 1..(startWeekDay - 1) %}
        <div class="day empty"></div>
    {% endfor %}

    {# ğŸ“† Jours du mois #}
    {% for day in 1..daysInMonth %}
        {% set fullDate = currentMonth|date('Y-m') ~ '-' ~ '%02d'|format(day) %}

        <div class="
            day
            {% if fullDate == 'now'|date('Y-m-d') %} today {% endif %}
            {% if fullDate in rdvDays %} has-appointment {% endif %}
        ">
            {{ day }}
        </div>
    {% endfor %}

</div>

</div>

<!-- Appointments -->
{#
<div class="appointments-section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 class="section-title">ğŸ©º Consultations d'Aujourd'hui</h2>
       
    </div>

    <div class="appointment-item">
        <div class="appointment-info">
            <div class="appointment-patient">Youssef Bouhmala</div>
            <div class="appointment-time">â° 09:00 - 09:30</div>
            <div class="appointment-reason">ContrÃ´le cardiaque</div>
        </div>
        <div class="appointment-actions">
            <button class="btn btn-primary btn-small" onclick="alert('Consulter patient')">Consulter</button>
            <button class="btn btn-secondary btn-small" onclick="alert('Ã‰crire ordonnance')">Ordonnance</button>
            <button class="btn btn-danger btn-small" onclick="alert('Annuler')">Annuler</button>
        </div>
    </div>

    <div class="appointment-item">
        <div class="appointment-info">
            <div class="appointment-patient">Mariam Saidi</div>
            <div class="appointment-time">â° 10:00 - 10:30</div>
            <div class="appointment-reason">Consultation de suivi</div>
        </div>
        <div class="appointment-actions">
            <button class="btn btn-primary btn-small" onclick="alert('Consulter patient')">Consulter</button>
            <button class="btn btn-secondary btn-small" onclick="alert('Ã‰crire ordonnance')">Ordonnance</button>
            <button class="btn btn-danger btn-small" onclick="alert('Annuler')">Annuler</button>
        </div>
    </div>

    <div class="appointment-item">
        <div class="appointment-info">
            <div class="appointment-patient">Hassan Khouibi</div>
            <div class="appointment-time">â° 11:00 - 11:30</div>
            <div class="appointment-reason">Consultation gÃ©nÃ©rale</div>
        </div>
        <div class="appointment-actions">
            <button class="btn btn-primary btn-small" onclick="alert('Consulter patient')">Consulter</button>
            <button class="btn btn-secondary btn-small" onclick="alert('Ã‰crire ordonnance')">Ordonnance</button>
            <button class="btn btn-danger btn-small" onclick="alert('Annuler')">Annuler</button>
        </div>
    </div>

    <div class="appointment-item">
        <div class="appointment-info">
            <div class="appointment-patient">Fatima El Mounia</div>
            <div class="appointment-time">â° 14:00 - 14:30</div>
            <div class="appointment-reason">Bilan de santÃ© annuel</div>
        </div>
        <div class="appointment-actions">
            <button class="btn btn-primary btn-small" onclick="alert('Consulter patient')">Consulter</button>
            <button class="btn btn-secondary btn-small" onclick="alert('Ã‰crire ordonnance')">Ordonnance</button>
            <button class="btn btn-danger btn-small" onclick="alert('Annuler')">Annuler</button>
        </div>
    </div>

    <div class="appointment-item">
        <div class="appointment-info">
            <div class="appointment-patient">Karim Bennani</div>
            <div class="appointment-time">â° 15:30 - 16:00</div>
            <div class="appointment-reason">Consultation urgente</div>
        </div>
        <div class="appointment-actions">
            <button class="btn btn-primary btn-small" onclick="alert('Consulter patient')">Consulter</button>
            <button class="btn btn-secondary btn-small" onclick="alert('Ã‰crire ordonnance')">Ordonnance</button>
            <button class="btn btn-danger btn-small" onclick="alert('Annuler')">Annuler</button>
        </div>
    </div>
</div>

<!-- Patients List -->
<div class="patients-section">
    <h2 class="section-title">ğŸ‘¥ Mes Patients RÃ©cents</h2>

    <div class="patient-item">
        <div class="patient-row">
            <div class="patient-avatar">YB</div>
            <div class="patient-info">
                <div class="patient-name">Youssef Bouhmala</div>
                <div class="patient-contact">ğŸ“§ youssef@email.com | ğŸ“ +212 6 12 34 56 78</div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="alert('Voir dossier')">Voir Dossier</button>
    </div>

    <div class="patient-item">
        <div class="patient-row">
            <div class="patient-avatar">MS</div>
            <div class="patient-info">
                <div class="patient-name">Mariam Saidi</div>
                <div class="patient-contact">ğŸ“§ mariam@email.com | ğŸ“ +212 6 23 45 67 89</div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="alert('Voir dossier')">Voir Dossier</button>
    </div>

    <div class="patient-item">
        <div class="patient-row">
            <div class="patient-avatar">HK</div>
            <div class="patient-info">
                <div class="patient-name">Hassan Khouibi</div>
                <div class="patient-contact">ğŸ“§ hassan@email.com | ğŸ“ +212 6 34 56 78 90</div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="alert('Voir dossier')">Voir Dossier</button>
    </div>

    <div class="patient-item">
        <div class="patient-row">
            <div class="patient-avatar">FEM</div>
            <div class="patient-info">
                <div class="patient-name">Fatima El Mounia</div>
                <div class="patient-contact">ğŸ“§ fatima@email.com | ğŸ“ +212 6 45 67 89 01</div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="alert('Voir dossier')">Voir Dossier</button>
    </div>
</div>#}
{% endblock %}
{% block javascripts %}
    {{ parent() }}
<script>
  let year = {{ calendarYear }};
  let month = {{ calendarMonth }};

  function goToMonth(y, m) {
    const mm = String(m).padStart(2, '0');
    window.location.href =
      "{{ path('medecin_dashboard') }}" + "?year=" + y + "&month=" + mm;
  }

  function previousMonth() {
    if (month === 1) {
      month = 12;
      year--;
    } else {
      month--;
    }
    goToMonth(year, month);
  }

  function nextMonth() {
    if (month === 12) {
      month = 1;
      year++;
    } else {
      month++;
    }
    goToMonth(year, month);
  }
</script>



{% endblock %}